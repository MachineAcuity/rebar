{"version":3,"sources":["../../../../units/rb-account-management-webapp/components/LoginDialog.jsx"],"names":["arrAuthPassportConfigurationEntries","Object","entries","authPassportConfiguration","styles","theme","dialogPaper","minWidth","grow","flex","userName","borderWidth","borderColor","fontWeight","paddingLeft","paddingRight","thirdPartyButtonsContainer","alignItems","display","gridGap","gridTemplateColumns","justifyItems","padding","LoginDialog","React","Component","constructor","props","context","_handle_Close","handlerClose","_handle_onClick_LogIn","UserAccount_Identifier","User_Secret","state","setState","currentOperation","loc","window","location","host","protocol","hostname","port","response","fetch","method","credentials","headers","body","JSON","stringify","responseData","json","success","replace","pathname","routeAfterLogin","errorMessage","error","err","message","_handle_onCLick_NewUser","handlerNewUser","_handle_onCLick_CancelLogIn","_handle_onClick_TryAgain","renderThirdPartyLogin","party","renderChallenge","classes","open","paper","event","target","value","ev","key","preventDefault","length","map","partyDetails","renderInProgress","renderFailure","render"],"mappings":"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","sourcesContent":["// @flow\n\nimport Alert from '@material-ui/lab/Alert'\nimport Button from '@material-ui/core/Button'\nimport Dialog from '@material-ui/core/Dialog'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContent from '@material-ui/core/DialogContent'\nimport DialogTitle from '@material-ui/core/DialogTitle'\nimport Divider from '@material-ui/core/Divider'\nimport LinearProgress from '@material-ui/core/LinearProgress'\nimport TextField from '@material-ui/core/TextField'\nimport Typography from '@material-ui/core/Typography'\nimport { withStyles } from '@material-ui/core/styles'\nimport React from 'react'\n\nimport authPassportConfiguration from '../../_configuration/rb-appbase-universal/authPassportConfiguration'\nimport routeAfterLogin from '../../_configuration/rb-account-management-webapp/routeAfterLogin'\n\nimport LoginDialogThirdPartyLoginButton from './LoginDialogThirdPartyLoginButton'\n\n//\n\nconst arrAuthPassportConfigurationEntries = Object.entries(authPassportConfiguration)\n\n//\n\nconst styles = (theme) => ({\n  dialogPaper: {\n    minWidth: 320,\n  },\n  grow: {\n    flex: '1 1 auto',\n  },\n  userName: {\n    borderWidth: 1,\n    borderColor: '#c0c0c0',\n    fontWeight: 'bold',\n    paddingLeft: 10,\n    paddingRight: 10,\n  },\n  thirdPartyButtonsContainer: {\n    alignItems: 'justify',\n    display: 'grid',\n    gridGap: 16,\n    gridTemplateColumns: 'auto auto',\n    justifyItems: 'center',\n    padding: 16,\n  },\n})\n\n//\n\nclass LoginDialog extends React.Component<\n  {\n    open: boolean,\n    handlerClose: Function,\n    handlerNewUser: Function,\n    classes: Object,\n  },\n  {\n    currentOperation: 'challenge' | 'in progress' | 'failure',\n    errorMessage: string,\n    UserAccount_Identifier: string,\n    User_Secret: string,\n  },\n> {\n  constructor(props: Object, context: Object) {\n    super(props, context)\n\n    this.state = {\n      currentOperation: 'challenge',\n      errorMessage: '',\n      UserAccount_Identifier: '',\n      User_Secret: '',\n    }\n  }\n\n  _handle_Close = () => {\n    this.props.handlerClose()\n  }\n\n  _handle_onClick_LogIn = async () => {\n    const { UserAccount_Identifier, User_Secret } = this.state\n\n    this.setState({\n      currentOperation: 'in progress',\n      User_Secret: '', // In order to prevent the password from being accessed later\n    })\n\n    try {\n      const loc = window.location\n      const host = loc.protocol + '//' + loc.hostname + ':' + loc.port\n\n      const response = await fetch(host + '/auth/login', {\n        method: 'POST',\n        credentials: 'same-origin',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          UserAccount_Identifier: UserAccount_Identifier,\n          User_Secret: User_Secret,\n        }),\n      })\n\n      const responseData = await response.json()\n\n      if (responseData.success) {\n        // In case of success, realod the application from server\n        window.location.replace(\n          window.location.pathname === '/' ? routeAfterLogin : window.location.pathname,\n        )\n      } else {\n        // In case of error, tell user what the error is\n        this.setState({\n          currentOperation: 'failure',\n          errorMessage: responseData.error,\n        }) // ZZZ Does server really send the reason for the failed login?\n      }\n    } catch (err) {\n      // In case response could not be received properly, tell the user\n      // In case of error, tell user what the error is\n      this.setState({\n        currentOperation: 'failure',\n        errorMessage:\n          'Did not receive proper response from server. Please try again later. Error:' +\n          err.message,\n      })\n    }\n  }\n\n  _handle_onCLick_NewUser = () => {\n    this.props.handlerNewUser()\n  }\n\n  _handle_onCLick_CancelLogIn = () => {\n    this.setState({\n      currentOperation: 'failure',\n      errorMessage: 'Log in has been canceled',\n    })\n  }\n\n  _handle_onClick_TryAgain = () => {\n    this.setState({\n      currentOperation: 'challenge',\n      errorMessage: '',\n    })\n  }\n\n  renderThirdPartyLogin(party) {}\n\n  renderChallenge() {\n    const { classes, open } = this.props\n    const { UserAccount_Identifier, User_Secret } = this.state\n\n    return (\n      <Dialog\n        classes={{ paper: classes.dialogPaper }}\n        open={open}\n        scroll=\"body\"\n        onClose={this._handle_Close}\n      >\n        <DialogTitle>Log In</DialogTitle>\n\n        <Divider />\n        <DialogContent>\n          <Typography variant=\"subtitle1\" gutterBottom>\n            Using user name and password:\n          </Typography>\n          <TextField\n            autoComplete=\"username\"\n            fullWidth={true}\n            label=\"E-Mail Address\"\n            margin=\"normal\"\n            value={UserAccount_Identifier}\n            variant=\"outlined\"\n            onChange={(event) => this.setState({ UserAccount_Identifier: event.target.value })}\n          />\n          <TextField\n            autoComplete=\"current-password\"\n            fullWidth={true}\n            label=\"Password\"\n            margin=\"normal\"\n            type=\"password\"\n            value={User_Secret}\n            variant=\"outlined\"\n            onChange={(event) => this.setState({ User_Secret: event.target.value })}\n            onKeyPress={(ev) => {\n              if (ev.key === 'Enter') {\n                this._handle_onClick_LogIn()\n                ev.preventDefault()\n              }\n            }}\n          />\n        </DialogContent>\n\n        <DialogActions>\n          <Button color=\"primary\" onClick={this._handle_onCLick_NewUser}>\n            New User\n          </Button>\n          <div className={classes.grow} />\n          <Button onClick={this._handle_Close}>Cancel</Button>\n          <Button color=\"primary\" onClick={this._handle_onClick_LogIn}>\n            Log In\n          </Button>\n        </DialogActions>\n\n        {arrAuthPassportConfigurationEntries.length > 0 && (\n          <div>\n            <br />\n            <Divider />\n            <DialogContent>\n              <Typography variant=\"subtitle1\" gutterBottom>\n                Using a third party:\n              </Typography>\n              <div className={classes.thirdPartyButtonsContainer}>\n                {arrAuthPassportConfigurationEntries.map(([ party, partyDetails ]) => (\n                  <LoginDialogThirdPartyLoginButton key={party} party={party} />\n                ))}\n              </div>\n            </DialogContent>\n          </div>\n        )}\n      </Dialog>\n    )\n  }\n\n  renderInProgress() {\n    const { classes, open } = this.props\n    const { UserAccount_Identifier } = this.state\n\n    return (\n      <Dialog classes={{ paper: classes.dialogPaper }} open={open} onClose={this._handle_Close}>\n        <DialogTitle>Logging in</DialogTitle>\n\n        <DialogContent>\n          <br />\n          <Alert variant=\"outlined\" severity=\"info\">\n            Logging in as\n            <span className={classes.userName}>{UserAccount_Identifier}</span>\n            Please wait ...\n          </Alert>\n          <br />\n          <br />\n          <LinearProgress mode=\"query\" />\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={this._handle_onCLick_CancelLogIn}>\n            Cancel\n          </Button>\n        </DialogActions>\n      </Dialog>\n    )\n  }\n\n  renderFailure() {\n    const { classes, open } = this.props\n    const { UserAccount_Identifier, errorMessage } = this.state\n\n    return (\n      <Dialog classes={{ paper: classes.dialogPaper }} open={open} onClose={this._handle_Close}>\n        <DialogTitle>Log In Failed</DialogTitle>\n\n        <DialogContent>\n          <br />\n          <Alert variant=\"outlined\" severity=\"error\">\n            Failed loggin in as\n            <span className={classes.userName}>{UserAccount_Identifier}</span> because:{' '}\n            {errorMessage}!\n          </Alert>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={this._handle_onClick_TryAgain}>Try Again</Button>\n        </DialogActions>\n      </Dialog>\n    )\n  }\n\n  render() {\n    const { currentOperation } = this.state\n\n    return (\n      <div>\n        {currentOperation === 'challenge' && this.renderChallenge()}\n        {currentOperation === 'in progress' && this.renderInProgress()}\n        {currentOperation === 'failure' && this.renderFailure()}\n      </div>\n    )\n  }\n}\n\nexport default withStyles(styles)(LoginDialog)\n"],"file":"LoginDialog.js"}