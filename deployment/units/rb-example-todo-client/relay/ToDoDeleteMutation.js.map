{"version":3,"sources":["../../../../units/rb-example-todo-client/relay/ToDoDeleteMutation.js"],"names":["mutation","sharedUpdater","store","user","deletedId","userProxy","get","id","forEach","status","connection","ConnectionHandler","getConnection","deleteNode","commit","environment","aToDo","variables","input","updater","payload","getRootField","getValue","optimisticUpdater","ToDo_TotalCount","setValue","ToDo_CompletedCount","ToDo_Complete"],"mappings":";;AAEA;AACA,6C;;AAEA,MAAMA,QAAQ,qIAAd;;;;;;;;;;;;AAYA,SAASC,aAAT,CAAuBC,KAAvB,EAA8BC,IAA9B,EAAoCC,SAApC,EAA+C;AAC7C,QAAMC,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAUH,IAAI,CAACI,EAAf,CAAlB;AACC,GAAE,KAAF,EAAS,QAAT,EAAmB,WAAnB,EAAiCC,OAAjC,CAA0CC,MAAD,IAAY;AACpD,UAAMC,UAAU,GAAGC,gCAAkBC,aAAlB,CAAgCP,SAAhC,EAA2C,gBAA3C,EAA6D,EAAEI,MAAF,EAA7D,CAAnB;AACA,QAAIC,UAAJ,EAAgB;AACdC,sCAAkBE,UAAlB,CAA6BH,UAA7B,EAAyCN,SAAzC;AACD;AACF,GALA;AAMF;;AAED,SAASU,MAAT,CAAgBC,WAAhB,EAA6BZ,IAA7B,EAAmCa,KAAnC,EAA0C;AACxC,SAAO,gCAAeD,WAAf,EAA4B;AACjCf,IAAAA,QADiC;AAEjCiB,IAAAA,SAAS,EAAE;AACTC,MAAAA,KAAK,EAAE,EAAEX,EAAE,EAAES,KAAK,CAACT,EAAZ,EADE,EAFsB;;;AAMjCY,IAAAA,OAAO,CAACjB,KAAD,EAAQ;AACb,YAAMkB,OAAO,GAAGlB,KAAK,CAACmB,YAAN,CAAmB,YAAnB,CAAhB;AACApB,MAAAA,aAAa,CAACC,KAAD,EAAQC,IAAR,EAAciB,OAAO,CAACE,QAAR,CAAiB,WAAjB,CAAd,CAAb;AACD,KATgC;;AAWjCC,IAAAA,iBAAiB,CAACrB,KAAD,EAAQ;AACvBD,MAAAA,aAAa,CAACC,KAAD,EAAQC,IAAR,EAAca,KAAK,CAACT,EAApB,CAAb;;AAEA,YAAMF,SAAS,GAAGH,KAAK,CAACI,GAAN,CAAUH,IAAI,CAACI,EAAf,CAAlB;AACA,YAAMiB,eAAe,GAAGnB,SAAS,CAACiB,QAAV,CAAmB,iBAAnB,CAAxB;AACA,UAAIE,eAAe,IAAI,IAAvB,EAA6B;AAC3BnB,QAAAA,SAAS,CAACoB,QAAV,CAAmBD,eAAe,GAAG,CAArC,EAAwC,iBAAxC;AACD;AACD,YAAME,mBAAmB,GAAGrB,SAAS,CAACiB,QAAV,CAAmB,qBAAnB,CAA5B;AACA,UAAII,mBAAmB,IAAI,IAA3B,EAAiC;AAC/B,YAAIV,KAAK,CAACW,aAAN,IAAuB,IAA3B,EAAiC;AAC/B,cAAIX,KAAK,CAACW,aAAV,EAAyB;AACvBtB,YAAAA,SAAS,CAACoB,QAAV,CAAmBC,mBAAmB,GAAG,CAAzC,EAA4C,qBAA5C;AACD;AACF,SAJD,MAIO,IAAIF,eAAe,IAAI,IAAvB,EAA6B;AAClC;AACA,cAAIA,eAAe,GAAG,CAAlB,GAAsBE,mBAA1B,EAA+C;AAC7CrB,YAAAA,SAAS,CAACoB,QAAV,CAAmBD,eAAe,GAAG,CAArC,EAAwC,qBAAxC;AACD;AACF;AACF;AACF,KAhCgC,EAA5B,CAAP;;AAkCD,C;;AAEc,EAAEV,MAAF,E","sourcesContent":["// @flow weak\n\nimport { commitMutation, graphql } from 'react-relay'\nimport { ConnectionHandler } from 'relay-runtime'\n\nconst mutation = graphql`\n  mutation ToDoDeleteMutation($input: ToDoDeleteInput!) {\n    ToDoDelete(input: $input) {\n      Viewer {\n        ToDo_TotalCount\n        ToDo_CompletedCount\n      }\n      deletedId\n    }\n  }\n`\n\nfunction sharedUpdater(store, user, deletedId) {\n  const userProxy = store.get(user.id)\n  ;[ 'any', 'active', 'completed' ].forEach((status) => {\n    const connection = ConnectionHandler.getConnection(userProxy, 'ToDoList_ToDos', { status })\n    if (connection) {\n      ConnectionHandler.deleteNode(connection, deletedId)\n    }\n  })\n}\n\nfunction commit(environment, user, aToDo) {\n  return commitMutation(environment, {\n    mutation,\n    variables: {\n      input: { id: aToDo.id },\n    },\n\n    updater(store) {\n      const payload = store.getRootField('ToDoDelete')\n      sharedUpdater(store, user, payload.getValue('deletedId'))\n    },\n\n    optimisticUpdater(store) {\n      sharedUpdater(store, user, aToDo.id)\n\n      const userProxy = store.get(user.id)\n      const ToDo_TotalCount = userProxy.getValue('ToDo_TotalCount')\n      if (ToDo_TotalCount != null) {\n        userProxy.setValue(ToDo_TotalCount - 1, 'ToDo_TotalCount')\n      }\n      const ToDo_CompletedCount = userProxy.getValue('ToDo_CompletedCount')\n      if (ToDo_CompletedCount != null) {\n        if (aToDo.ToDo_Complete != null) {\n          if (aToDo.ToDo_Complete) {\n            userProxy.setValue(ToDo_CompletedCount - 1, 'ToDo_CompletedCount')\n          }\n        } else if (ToDo_TotalCount != null) {\n          // Note this is the old ToDo_TotalCount.\n          if (ToDo_TotalCount - 1 < ToDo_CompletedCount) {\n            userProxy.setValue(ToDo_TotalCount - 1, 'ToDo_CompletedCount')\n          }\n        }\n      }\n    },\n  })\n}\n\nexport default { commit }\n"],"file":"ToDoDeleteMutation.js"}