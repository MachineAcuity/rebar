(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1355:function(e,a,t){"use strict";t.r(a);var n=t(137),l=t(71),r=t(46),i=t(97),s=t(47),o=t(402),m=t(5),c=t(685),d=t.n(c),u=t(0),p=t.n(u),h=t(11),g=t(36),_=t(500),U=t(747),f=t(1334),y=t(704),P=t(181);const E=/(.+?)\.([^.]*$|$)/;class b extends p.a.Component{constructor(e,a){super(e,a),this._handle_onDrop=e=>{if(!(e.length<1))if(e.length<1)alert("Please choose one image");else{const a=e[0],t=URL.createObjectURL(a),{fileName:n,fileNameExtension:l}=function(e){let a=E.exec(e);a||(a=[null,e,"jpg"]);const t=a[1];let n="",l=!0;for(let e=0;e<t.length;e++){let a=t.charAt(e);a>="a"&&a<="z"?(l&&(a=a.toUpperCase(),l=!1),n+=a):a>="A"&&a<="Z"?(l=!1,n+=a):a>="0"&&a<="9"?(l=!0,n+=a):l=!0}if(!a[2])throw new Error;return{fileName:n,fileNameExtension:a[2].toLowerCase()}}(a.name);this.setState({fileDropped:a,fileDroppedPreview:t,fileName:n,fileNameExtension:l})}},this._handle_onChangeFileName=e=>{this.setState({fileName:e.target.value})},this._handle_onClickUpload=()=>{const{parameters:e}=this.props,{fileName:a,fileNameExtension:t,fileDropped:n}=this.state;if(!n)return;const l=new FormData;l.append("uploadedFile",n),l.append("fileName",a),l.append("fileNameExtension",t);for(let a in e)l.append(a,e[a]);var r=new XMLHttpRequest;r.open("POST","/rb-image-manager/upload"),r.setRequestHeader("UserToken2",Object(P.a)()),r.onreadystatechange=()=>{4===r.readyState&&(200===r.status?this._handle_onUploadSuccess(r.responseText):this._handle_onUploadFailure(r.responseText))},r.send(l)},this._handle_onUploadSuccess=e=>{try{const a=JSON.parse(e).fileName;this.props.onChange(a)}catch(e){alert("Image upload failed")}this.releasePreview(),this.setState({fileDropped:null,fileDroppedPreview:null,fileName:""})},this._handle_onUploadFailure=e=>{alert("Image upload failed"),this.releasePreview(),this.setState({fileDropped:null,fileDroppedPreview:null,fileName:""})},this._handle_onClickCalcelUpload=()=>{this.releasePreview(),this.setState({fileDropped:null,fileDroppedPreview:null,fileName:""})},this.state={fileDropped:null,fileDroppedPreview:null,fileName:"",fileNameExtension:""}}componentWillUnmount(){this.releasePreview()}releasePreview(){const{fileDroppedPreview:e}=this.state;e&&URL.revokeObjectURL(e)}renderFilesDropped(){const{classes:e,customizeFileName:a,label:t}=this.props,{fileName:n,fileDroppedPreview:r}=this.state;return p.a.createElement("div",null,p.a.createElement(_.a,{fullWidth:!0},p.a.createElement(f.a,null,t)),p.a.createElement("br",null),p.a.createElement("br",null),p.a.createElement("br",null),p.a.createElement("div",{className:e.dropZone},p.a.createElement("img",{alt:"Preview",className:e.currentImage,src:r})),a&&p.a.createElement("br",null),a&&p.a.createElement(_.a,{fullWidth:!0},p.a.createElement(f.a,null,"File Name"),p.a.createElement(U.a,{value:n,onChange:this._handle_onChangeFileName})),p.a.createElement(l.a,{className:e.buttonProperties,onClick:this._handle_onClickUpload},"Upload"),p.a.createElement(l.a,{className:e.buttonProperties,onClick:this._handle_onClickCalcelUpload},"Clear"),p.a.createElement("br",null),p.a.createElement("br",null))}renderFilesNotDropped(){const{classes:e,label:a,parameters:t,value:n}=this.props,l=""!==n?"url(/rb-image-manager/download?"+Object.entries(t).map(([e,a])=>encodeURIComponent(e)+"="+encodeURIComponent(a)+"&").join("")+"UserToken2="+Object(P.a)()+"&fileName="+encodeURIComponent(n)+")":"";return console.log({XXX:l}),p.a.createElement("div",null,p.a.createElement(_.a,{fullWidth:!0},p.a.createElement(f.a,null,a)),p.a.createElement("br",null),p.a.createElement("br",null),p.a.createElement("br",null),p.a.createElement(y.a,{multiple:!1,ref:"dropzone",onDrop:this._handle_onDrop,className:e.dropZone,activeClassName:e.dzActive,rejectClassName:e.dzReject},({getRootProps:a,getInputProps:t})=>p.a.createElement("div",a({className:e.currentImage,style:{backgroundImage:l}}),p.a.createElement("input",t()),""!==n&&p.a.createElement("p",null),""===n&&p.a.createElement("div",{style:{textAlign:"center"}},p.a.createElement("br",null),p.a.createElement("br",null),"Click or drag"))),p.a.createElement("br",null),p.a.createElement("br",null))}render(){const{fileDropped:e}=this.state;return e?this.renderFilesDropped():this.renderFilesNotDropped()}}var C,k=Object(m.a)(e=>({buttonProperties:{marginTop:e.spacing(1),marginBottom:e.spacing(1)},dropZone:{backgroundColor:"#a0a0a0",border:"#000000 1px dashed",width:256,height:256},currentImage:{backgroundSize:"100% auto",backgroundRepeat:"no-repeat",backgroundPosition:"center center",width:256,height:256},dzActive:{border:"#ff0000 1px dashed",backgroundColor:"#800000",opacity:1},dzReject:{backgroundColor:"#800000",border:"0px",opacity:.5}}))(b);const N=void 0!==C?C:C=t(753);function v(e,a,t){return{UserUpdate:{User:{User_DisplayName:e,User_PrimaryEmail:a,User_PrimaryPhone:t}}}}var w,D={commit:function(e,a,t,n){return Object(h.commitMutation)(e,{mutation:N,variables:{input:{User_DisplayName:a,User_PrimaryEmail:t,User_PrimaryPhone:n}},optimisticResponse:v(a,t,n)})}},F=t(177),S=t(35);const x={card:{minWidth:350,maxWidth:1200},...g.a};class R extends p.a.Component{constructor(e,a){super(e,a),j.call(this);const{User_DisplayName:t,User_PrimaryEmail:n,User_PrimaryPhone:l}=e.Viewer;this.state={imageURL:"Place original image url? How do we know if there is a photo?",User_DisplayName:t,User_PrimaryEmail:n,User_PrimaryPhone:l}}render(){const{classes:e,Viewer:a}=this.props;if(a.User_IsAnonymous)return p.a.createElement(F.a,null);const{imageURL:t,User_DisplayName:n,User_PrimaryEmail:m,User_PrimaryPhone:c}=this.state;return(p.a.createElement(S.a,null,p.a.createElement(g.b,{icon:p.a.createElement(d.a,null),subTitle:"Profile & settings",title:"User"}),p.a.createElement(r.a,{className:e.card},p.a.createElement(s.a,null,p.a.createElement(k,{label:"Profile photo",parameters:{isUserProfilePhoto:"true"},value:t,onChange:e=>{this.setState({imageURL:e})}}),p.a.createElement(o.a,{autoComplete:"name",fullWidth:!0,label:"Display Name",margin:"normal",value:n,variant:"outlined",onChange:this._handle_onChange_DisplayName}),p.a.createElement(o.a,{autoComplete:"email",fullWidth:!0,label:"Contact email (not account identifier)",margin:"normal",value:m,variant:"outlined",onChange:this._handle_onChange_PrimaryEmail}),p.a.createElement(o.a,{autoComplete:"tel",fullWidth:!0,label:"Contact phone",margin:"normal",value:c,variant:"outlined",onChange:this._handle_onChange_PrimaryPhone})),p.a.createElement(i.a,null,p.a.createElement(l.a,{onClick:this._handle_onClick_Update},"Update"),p.a.createElement(l.a,{onClick:this._handle_onClick_ChangePassword},"Change password")))))}}var j=function(){this._handle_onChange_DisplayName=e=>{const a=e.target.value;this.setState({User_DisplayName:a})},this._handle_onChange_PrimaryEmail=e=>{const a=e.target.value;this.setState({User_PrimaryEmail:a})},this._handle_onChange_PrimaryPhone=e=>{const a=e.target.value;this.setState({User_PrimaryPhone:a})},this._handle_onClick_ChangePassword=()=>{this.props.router.push("/user/change-secret")},this._handle_onClick_Update=()=>{const{User_DisplayName:e,User_PrimaryEmail:a,User_PrimaryPhone:t}=this.state,{relay:n}=this.props;D.commit(n.environment,e,a,t)}};a.default=Object(h.createFragmentContainer)(Object(m.a)(x)(Object(n.withRouter)(R)),{Viewer:void 0!==w?w:w=t(754)})},753:function(e,a,t){"use strict";const n={fragment:{argumentDefinitions:l=[{defaultValue:null,kind:"LocalArgument",name:"input",type:"UserUpdateInput!"}],kind:"Fragment",metadata:null,name:"UserUpdateMutation",selections:[{alias:null,args:r=[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"UserUpdatePayload",kind:"LinkedField",name:"UserUpdate",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"Viewer",plural:!1,selections:[i={alias:null,args:null,kind:"ScalarField",name:"User_DisplayName",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"User_PrimaryEmail",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"User_PrimaryPhone",storageKey:null}],storageKey:null}],storageKey:null}],type:"Mutation"},kind:"Request",operation:{argumentDefinitions:l,kind:"Operation",name:"UserUpdateMutation",selections:[{alias:null,args:r,concreteType:"UserUpdatePayload",kind:"LinkedField",name:"UserUpdate",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"Viewer",plural:!1,selections:[i,s,o,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:null,metadata:{},name:"UserUpdateMutation",operationKind:"mutation",text:"mutation UserUpdateMutation(\n  $input: UserUpdateInput!\n) {\n  UserUpdate(input: $input) {\n    Viewer {\n      User_DisplayName\n      User_PrimaryEmail\n      User_PrimaryPhone\n      id\n    }\n  }\n}\n"}};var l,r,i,s,o;n.hash="abeb70f0be768871d470d7f4f52a7e96",e.exports=n},754:function(e,a,t){"use strict";const n={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserProfileScreen_Viewer",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"User_IsAnonymous",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"User_DisplayName",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"User_PrimaryEmail",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"User_PrimaryPhone",storageKey:null}],type:"Viewer",hash:"0bacd47e4714e448ac9e04f60fc3501e"};e.exports=n}}]);